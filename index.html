<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>VR</title>
  <!--A-Frame-->
  <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
</head>

<body>
  <script>
    var skin_list = ["dirt.png", "moss.png", "stone.png", "diamond.png", "tnt.png"];
    var skin_number = 0;
    var last_number = 0;
    AFRAME.registerComponent("input-listen", {
      //初期化
      init: function () {
        //トリガーを押した時(両手)
        this.el.addEventListener("triggerdown", function (e) {
          //コントローラの3次元的な位置を取得
          var position = this.object3D.getWorldPosition();
          var scene = document.querySelector("a-scene");
          var box = add_box(position, last_number);
          scene.appendChild(box);
        });
        //Aボタンを押した時(右手のみ)
        this.el.addEventListener("abuttondown", function (e) {
          if (skin_number < 4) {
            skin_number++
          } else {
            skin_number = 0;
          }
          document.getElementById("text").setAttribute("value", skin_list[skin_number])
        });
        //Bボタンを押した時(右手のみ)
        this.el.addEventListener("bbuttondown", function (e) {
        });
        //Xボタンを押した時(左手のみ)
        this.el.addEventListener("xbuttondown", function (e) {
          var remove = document.getElementsByClassName("pos" + last_number);
          remove[0].parentNode.removeChild(remove[0]);

        });
        //Xボタンを離した時(左手)
        this.el.addEventListener("xbuttonup", function (e) {
        });
      },

      //毎フレーム更新 (今回は使わない)
      tick: function () { },
    });

    function add_box(position, last_number) {

      var box = document.createElement("a-box");
      var pos = [];
      pos[0] = (Math.round(position.x * 10) / 10);
      pos[1] = (Math.round(position.y * 10) / 10);
      pos[2] = (Math.round(position.z * 10) / 10);
      box.setAttribute("color", "#ffffff");
      box.setAttribute("rotation", "0 0 0");
      box.setAttribute("width", "0.1");
      box.setAttribute("height", "0.1");
      box.setAttribute("depth", "0.1");
      box.setAttribute("position", pos[0] + " " + pos[1] + " " + pos[2]);
      box.setAttribute("src", skin_list[skin_number]);
      box.setAttribute("class", "pos" + last_number);
      return box;
    }

  </script>

  <a-scene>
    <!--コントローラ-->
    <a-entity oculus-touch-controls="hand: left" input-listen> </a-entity>
    <a-entity oculus-touch-controls="hand: right" input-listen> </a-entity>
    <a-sky src="space.png"></a-sky>
    <a-entity camera>
      <a-text id="text" position="-0.25 -1 -2" color="white" scale="1"></a-text>
    </a-entity>
  </a-scene>
</body>

</html>